<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout</title>
  <link rel="stylesheet" href="./checkout.css">
</head>
<body>
  
  <div class="checkout-container">
    <!-- Shipping Info -->
   
    <div class="shipping-info">
      <a  class="back" href="./cartInfor.html" class="go-back">&larr; Back to Cart</a>
      <h2>Checkout</h2>
      <h3>1. Shipping Info</h3>
      <form>
        <input type="email" placeholder="Email address" required>
        <input type="text" placeholder="Full name" required>
        <input type="text" placeholder="Street address" required>
        <input type="text" placeholder="Address line 2">
        <div class="row">
          <input type="text" placeholder="City" required>
          <select > <!--i removed required-->
            <option value="" disabled selected>Pick a State or Territory</option>
            <option value="AL">Alabama</option>
            <option value="AK">Alaska</option>
            <option value="AZ">Arizona</option>
            <option value="AR">Arkansas</option>
            <option value="CA">California</option>
            <option value="CO">Colorado</option>
            <option value="CT">Connecticut</option>
            <option value="DE">Delaware</option>
            <option value="FL">Florida</option>
            <option value="GA">Georgia</option>
            <option value="HI">Hawaii</option>
            <option value="ID">Idaho</option>
            <option value="IL">Illinois</option>
            <option value="IN">Indiana</option>
            <option value="IA">Iowa</option>
            <option value="KS">Kansas</option>
            <option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option>
            <option value="ME">Maine</option>
            <option value="MD">Maryland</option>
            <option value="MA">Massachusetts</option>
            <option value="MI">Michigan</option>
            <option value="MN">Minnesota</option>
            <option value="MS">Mississippi</option>
            <option value="MO">Missouri</option>
            <option value="MT">Montana</option>
            <option value="NE">Nebraska</option>
            <option value="NV">Nevada</option>
            <option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option>
            <option value="NM">New Mexico</option>
            <option value="NY">New York</option>
            <option value="NC">North Carolina</option>
            <option value="ND">North Dakota</option>
            <option value="OH">Ohio</option>
            <option value="OK">Oklahoma</option>
            <option value="OR">Oregon</option>
            <option value="PA">Pennsylvania</option>
            <option value="RI">Rhode Island</option>
            <option value="SC">South Carolina</option>
            <option value="SD">South Dakota</option>
            <option value="TN">Tennessee</option>
            <option value="TX">Texas</option>
            <option value="UT">Utah</option>
            <option value="VT">Vermont</option>
            <option value="VA">Virginia</option>
            <option value="WA">Washington</option>
            <option value="WV">West Virginia</option>
            <option value="WI">Wisconsin</option>
            <option value="WY">Wyoming</option>
            <!-- Add state options -->
          </select>
        </div>
        <div class="row">
          <input type="text" placeholder="Zip code" required>
          <select ><!--i removed required-->
            <option value="" disabled selected>Select your country</option>
            <option value="US">United States</option>
            <option value="AL">Albania</option>
            <option value="AD">Andorra</option>
            <option value="AG">Antigua and Barbuda</option>
            <option value="AR">Argentina</option>
            <option value="AW">Aruba</option>
            <option value="AU">Australia</option>
            <option value="AT">Austria</option>
            <option value="AZ">Azerbaijan</option>
            <option value="BS">Bahamas (the)</option>
            <option value="BD">Bangladesh</option>
            <option value="BB">Barbados</option>
            <option value="BE">Belgium</option>
            <option value="BM">Bermuda</option>
            <option value="BA">Bosnia and Herzegovina</option>
            <option value="BG">Bulgaria</option>
            <option value="CA">Canada</option>
            <option value="CR">Costa Rica</option>
            <option value="HR">Croatia</option>
            <option value="CY">Cyprus</option>
            <option value="CZ">Czech Republic</option>
            <option value="DK">Denmark</option>
            <option value="DM">Dominica</option>
            <option value="EG">Egypt</option>
            <option value="LT">Lithuania</option>
            <option value="LU">Luxembourg</option>
            <option value="MO">Macao</option>
            <option value="MK">Macedonia</option>
            <option value="MY">Malaysia</option>
            <option value="MV">Maldives</option>
            <option value="MT">Malta</option>
            <option value="MU">Mauritius</option>
            <option value="MX">Mexico</option>
            <option value="MD">Moldova, Republic of</option>
            <option value="MC">Monaco</option>
            <option value="ME">Montenegro</option>
            <option value="NL">Netherlands</option>
            <option value="NZ">New Zealand</option>
            <option value="NO">Norway</option>
            <option value="PK">Pakistan</option>
            <option value="PA">Panama</option>
            <option value="PE">Peru</option>
            <option value="PL">Poland</option>
            <option value="PT">Portugal</option>
            <option value="PR">Puerto Rico</option>
            <option value="QA">Qatar</option>
            <option value="RO">Romania</option>
            <!-- Add country options -->
          </select>
        </div>
        <input type="tel" placeholder="Phone number" required>
        <button type="submit" class="btn">Go to Shipping Method</button>
      </form>
    </div>

    <!-- Order Summary -->
    <div class="order-summary">
      <h3>Order Summary</h3>
      
      <!-- Products will be dynamically rendered here -->
      <div id="order-items-container"></div>

      <!-- Price Breakdown -->
      <div class="price-breakdown">
        <!-- Totals will be dynamically rendered here -->
      </div>

      <p class="info-text">Standard orders are typically processed within 5 business days. Expedited orders are processed within 1 business day.</p>
      <div class="security-logos">
        <img src="norton-secured-logo.png" alt="Norton Secured">
        <img src="truste-verified-logo.png" alt="TRUSTe Verified">
      </div>
      <div class="payment-logo">
        <p>Payments fulfilled by GearLaunch</p>
        <img src="gearlaunch-logo.png" alt="GearLaunch">
      </div>
    </div>
  </div>


  <!-- Address Verification Modal -->
<div id="address-modal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h3>Verify Address</h3>
    <p>Please review the address you entered to make sure it is correct.</p>
    <p>You can select 'Edit Address' to make any changes or 'Use this Address anyway' to continue.</p>
    <div class="address-details">
      <h4>You Entered</h4>
      <p id="entered-address"></p>
    </div>
    <div class="modal-actions">
      <button id="use-address" class="btn">Use this Address anyway</button>
      <button id="edit-address" class="btn">Edit Address</button>
    </div>
  </div>
</div>


  <script>
    // Retrieve cart items from sessionStorage
    const cartItems = JSON.parse(sessionStorage.getItem('cart')) || [];
    const orderItemsContainer = document.getElementById('order-items-container');
    const priceBreakdownContainer = document.querySelector('.price-breakdown');
  
    // Shipping and warranty fees
    const shippingFee = 5.99;
    const warrantyFee = 0.98;
    const taxRate = 0.07;
  
    // Function to render order summary
    function renderOrderSummary() {
      let subtotal = 0;
      orderItemsContainer.innerHTML = ''; // Clear previous items
  
      // Render each cart item
      cartItems.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.classList.add('order-item');
        
        itemElement.innerHTML = `
          <div class="order-item-details">
            <img src="${item.imgSrc}" alt="${item.name}" class="order-item-image">
            <div class="order-item-info">
              <p><strong>${item.name}</strong></p>
              <p>Qty: ${item.quantity}</p>
              <p>Price: $${(item.price * item.quantity).toFixed(2)}</p>
            </div>
          </div>
        `;
  
        orderItemsContainer.appendChild(itemElement);
        subtotal += item.price * item.quantity; // Update subtotal
      });
  
      // Calculate totals
      const tax = subtotal * taxRate;
      const total = subtotal + tax + shippingFee + warrantyFee;
  
      // Update price breakdown
      priceBreakdownContainer.innerHTML = `
        <p>Subtotal: <span>$${subtotal.toFixed(2)}</span></p>
        <p>Shipping Warranty: <span>$${warrantyFee.toFixed(2)}</span></p>
        <p>Shipping: <span>$${shippingFee.toFixed(2)}</span></p>
        <p>Tax (7%): <span>$${tax.toFixed(2)}</span></p>
        <hr>
        <p class="total">Total: <span>USD $${total.toFixed(2)}</span></p>
      `;
    }
  
    // Initialize the order summary
    renderOrderSummary();



    // pop out for address confirmation
    const modal = document.getElementById('address-modal');
  const closeBtn = document.querySelector('.close-btn');
  const useAddressBtn = document.getElementById('use-address');
  const editAddressBtn = document.getElementById('edit-address');
  const enteredAddress = document.getElementById('entered-address');

  const form = document.querySelector('form');

  form.addEventListener('submit', (e) => {
    e.preventDefault(); // Prevent form submission

    // Collect form data
    const email = form.querySelector('input[type="email"]').value;
    const fullName = form.querySelector('input[placeholder="Full name"]').value;
    const street = form.querySelector('input[placeholder="Street address"]').value;
    const addressLine2 = form.querySelector('input[placeholder="Address line 2"]').value;
    const city = form.querySelector('input[placeholder="City"]').value;
    const state = form.querySelector('select').value;
    const zip = form.querySelector('input[placeholder="Zip code"]').value;
    const phone = form.querySelector('input[type="tel"]').value;

    // Display the entered data in the modal
    enteredAddress.innerHTML = `
      ${fullName}<br>
      ${street}${addressLine2 ? `, ${addressLine2}` : ''}<br>
      ${city}, ${state} ${zip}<br>
      ${phone}<br>
    `;

    // Show the modal
    modal.style.display = 'block';
  });

  // Close the modal
  closeBtn.addEventListener('click', () => {
    modal.style.display = 'none';
  });

  // Handle "Use this Address anyway" button
  useAddressBtn.addEventListener('click', () => {
    // Save address details to sessionStorage
    const addressDetails = {
      email: form.querySelector('input[type="email"]').value,
      fullName: form.querySelector('input[placeholder="Full name"]').value,
      street: form.querySelector('input[placeholder="Street address"]').value,
      addressLine2: form.querySelector('input[placeholder="Address line 2"]').value,
      city: form.querySelector('input[placeholder="City"]').value,
      state: form.querySelector('select').value,
      zip: form.querySelector('input[placeholder="Zip code"]').value,
      phone: form.querySelector('input[type="tel"]').value,
    };
    sessionStorage.setItem('address', JSON.stringify(addressDetails));

    // Navigate to the shipping method page
    window.location.href = './shippingMethod.html';
  });;

  // Handle "Edit Address" button
  editAddressBtn.addEventListener('click', () => {
    modal.style.display = 'none';
    alert('Please edit your address.');
  });

  // Close modal if clicking outside of it
  window.addEventListener('click', (e) => {
    if (e.target == modal) {
      modal.style.display = 'none';
    }
  });
  
  </script>
</body>
</html>
